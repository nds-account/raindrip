<?php class jsshparams{        function get($key) {		global $param_values;	        return $param_values[$key];    }}/*** @copyright    Copyright (C) 2009 Open Source Matters. All rights reserved.* @license      GNU/GPL*/defined( '_JEXEC' ) or die( 'Restricted access' );class JFormFieldselectcategory extends JFormField{    function open_cat_in_tree( $catt, $tree_problem='', $hihiih=1){$db =JFactory::getDBO();static $trr_cat=array();if($hihiih)$trr_cat=array();if (is_array($catt))foreach($catt as $dog){	$dog->name=$tree_problem.$dog->name;	array_push($trr_cat,$dog);	$new_cat_query=	"SELECT  a.* ,  COUNT(b.id) AS count, g.par_name AS par_name FROM #__spidercatalog_product_categories  AS a LEFT JOIN #__spidercatalog_product_categories AS b ON a.id = b.parent LEFT JOIN (SELECT  #__spidercatalog_product_categories.`ordering` as `ordering`, #__spidercatalog_product_categories.id AS id, COUNT( #__spidercatalog_products.category_id ) AS prod_countFROM #__spidercatalog_products, #__spidercatalog_product_categoriesWHERE #__spidercatalog_products.category_id = #__spidercatalog_product_categories.idGROUP BY #__spidercatalog_products.category_id) AS c ON c.id = a.id LEFT JOIN(SELECT #__spidercatalog_product_categories.name AS par_name,#__spidercatalog_product_categories.id FROM #__spidercatalog_product_categories) AS g ON a.parent=g.id WHERE a.parent=".$db->escape($dog->id)." group by a.id";   	$db->setQuery($new_cat_query);	$new_cat = $db->loadObjectList();  $this->open_cat_in_tree($new_cat,$tree_problem. "â€” ",0);}return $trr_cat;}  protected $type = 'selectcategory';public function getInput()  {  JRequest::setVar('hidemainmenu', 1);    $params =new jsshparams;        $doc =JFactory::getDocument();    $plugin_js_path = JURI::root(true) . '/administrator/components/com_spidercatalog/js';    $doc->addScript($plugin_js_path . "/param_block.js");	    $lists            = array();	    $category_id['0'] = array(        'value' => '0',        'text' => 'All Categories'    );    $db =JFactory::getDBO();    $query = "SELECT * FROM #__spidercatalog_product_categories where published=1 AND parent=0";    $db->setQuery($query);    $rows1 = $db->loadObjectList();    if ($db->getErrorNum())      {        echo $db->stderr();        return false;      }   $rows2=$this->open_cat_in_tree($rows1);  $rows3=array();   $count_of_cat=count( $rows2);   $ii=0;   for($k=0;$k<$count_of_cat;$k++){		if($rows2[$k]->published){		$rows3[$ii]=$rows2[$k];		$ii++;		}   }   $rows2= $rows3;    for ($i = 0, $n = count($rows2); $i < $n; $i++)      {	          $row1 = $rows2[$i];        $id1               = $row1->id;				        $category_id[$id1] = array(            'value' => $row1->id,            'text' =>$row1->name        );	      }  $lists['category_id'] = JHTML::_('select.genericList', $category_id, $this->name, 'class="inputbox" ' . '', 'value', 'text', $this->value);     return $lists['category_id'];      }}     ?>